<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Live Bet Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    .high-rating { background: #c8f7c5; }
    .medium-rating { background: #fff7c5; }
    .low-rating { background: #f7c5c5; }
  </style>
</head>
<body>
  <h1>Live Bet Analyzer</h1>
  <p>Loading matchesâ€¦</p>
  <table id="betsTable">
    <tr>
      <th>Match</th><th>Odds</th><th>Prob %</th><th>EV</th><th>ROI %</th><th>Risk %</th><th>Rating</th>
    </tr>
  </table>

<script>
const PROXY_URL = "https://worker1.charliegdowd.workers.dev/"; // ðŸ‘ˆ replace this

// basic rating
function score(ev, roi, risk) {
  let s = ev*3 + roi*0.1 - risk*0.1;
  if (s < 0) s = 0;
  if (s > 10) s = 10;
  return s.toFixed(1);
}

function renderTable(bets) {
  const tbl = document.getElementById("betsTable");
  bets.forEach(b => {
    const row = tbl.insertRow();
    row.insertCell(0).innerText = b.name;
    row.insertCell(1).innerText = b.odds;
    row.insertCell(2).innerText = b.prob;
    row.insertCell(3).innerText = b.ev;
    row.insertCell(4).innerText = b.roi;
    row.insertCell(5).innerText = b.risk;
    const cell = row.insertCell(6);
    cell.innerText = b.rating;
    if (b.rating >= 7) cell.className = "high-rating";
    else if (b.rating >= 4) cell.className = "medium-rating";
    else cell.className = "low-rating";
  });
}

// fetch live fixtures
fetch(`${PROXY_URL}/v3/football/fixtures?date=2026-02-17`)
  .then(r => r.json())
  .then(data => {
    const bets = [];
    if (data.response && Array.isArray(data.response)) {
      data.response.forEach(match => {
        const home = match.teams?.home?.name;
        const away = match.teams?.away?.name;
        const name = `${home} vs ${away}`;

        // pull odds if available
        let odds = 2.0;
        if (match.bookmakers?.[0]?.markets?.[0]?.outcomes?.[0]?.price) {
          odds = parseFloat(match.bookmakers[0].markets[0].outcomes[0].price);
        }
        const prob = ((1/odds) * 100).toFixed(1); 
        const ev = (odds * (prob/100) - 1).toFixed(2);
        const roi = ((odds - 1) * (prob/100) * 100).toFixed(1);
        const risk = ((1 - (prob/100)) * 100).toFixed(1);
        const rating = score(ev,roi,risk);

        bets.push({ name, odds, prob, ev, roi, risk, rating });
      });
    }
    renderTable(bets);
  })
  .catch(err => console.error("Fetch error:", err));
</script>

</body>
</html>
