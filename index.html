<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Bet Analyzer</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .high-rating { background-color: #c8f7c5; }
    .medium-rating { background-color: #fff7c5; }
    .low-rating { background-color: #f7c5c5; }
</style>
</head>
<body>
<h1>Live Bet Analyzer</h1>
<p>Loading live matchesâ€¦</p>

<table id="betsTable">
<tr>
    <th>Match</th><th>Odds</th><th>Prob %</th><th>EV</th><th>ROI %</th><th>Risk %</th><th>Rating</th>
</tr>
</table>

<script>
const bets = [];
const PROXY_URL = "https://worker1.charliegdowd.workers.dev"; // your Worker URL

function calculateRating(ev, roi, risk){
    let score = ev*3 + roi*0.1 - risk*0.1;
    if(score<0) score=0;
    if(score>10) score=10;
    return score.toFixed(1);
}

function renderTable(){
    const table = document.getElementById("betsTable");
    bets.forEach(bet=>{
        const row = table.insertRow();
        row.insertCell(0).innerText = bet.name;
        row.insertCell(1).innerText = bet.odds;
        row.insertCell(2).innerText = bet.prob;
        row.insertCell(3).innerText = bet.ev;
        row.insertCell(4).innerText = bet.roi;
        row.insertCell(5).innerText = bet.risk;
        const ratingCell = row.insertCell(6);
        ratingCell.innerText = bet.rating;
        if(bet.rating>=7) ratingCell.className="high-rating";
        else if(bet.rating>=4) ratingCell.className="medium-rating";
        else ratingCell.className="low-rating";
    });
}

// Fetch live matches from Worker
fetch(`${PROXY_URL}/v3/football/fixtures?live=all`) // change query if needed
.then(r=>r.json())
.then(data=>{
    if(!data.response || !Array.isArray(data.response)){
        console.error("No matches returned:", data);
        return;
    }

    data.response.forEach(match=>{
        const home = match.teams?.home?.name || "Home";
        const away = match.teams?.away?.name || "Away";
        const name = `${home} vs ${away}`;

        // pull odds if available
        let odds = 2.0; // fallback
        if(match.bookmakers?.[0]?.markets?.[0]?.outcomes?.[0]?.price){
            odds = parseFloat(match.bookmakers[0].markets[0].outcomes[0].price);
        }

        const prob = ((1/odds)*100).toFixed(1); 
        const ev = (odds*(prob/100)-1).toFixed(2);
        const roi = ((odds-1)*(prob/100)*100).toFixed(1);
        const risk = ((1-(prob/100))*100).toFixed(1);
        const rating = calculateRating(ev, roi, risk);

        bets.push({name, odds, prob, ev, roi, risk, rating});
    });

    renderTable();
})
.catch(err=>console.error("Error fetching API:", err));
</script>
</body>
</html>
